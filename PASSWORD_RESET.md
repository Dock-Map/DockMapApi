# –°–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è —á–µ—Ä–µ–∑ Email

## –û–ø–∏—Å–∞–Ω–∏–µ

–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º, –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º —á–µ—Ä–µ–∑ email, –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∞–∫–∫–∞—É–Ω—Ç—É —Å –ø–æ–º–æ—â—å—é 6-–∑–Ω–∞—á–Ω–æ–≥–æ –∫–æ–¥–∞, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º–æ–≥–æ –Ω–∞ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—É—é –ø–æ—á—Ç—É.

## –°—Ö–µ–º–∞ —Ä–∞–±–æ—Ç—ã

1. **–ó–∞–ø—Ä–æ—Å —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç email ‚Üí –Ω–∞–∂–∏–º–∞–µ—Ç ¬´–°–±—Ä–æ—Å–∏—Ç—å –ø–∞—Ä–æ–ª—å¬ª
2. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–¥–∞**: –ë—ç–∫–µ–Ω–¥ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç 6-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥ (123456)
3. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ**: –ö–æ–¥ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö —Å TTL 10 –º–∏–Ω—É—Ç
4. **–û—Ç–ø—Ä–∞–≤–∫–∞ email**: Email —Å –∫—Ä–∞—Å–∏–≤—ã–º —à–∞–±–ª–æ–Ω–æ–º –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
5. **–í–≤–æ–¥ –∫–æ–¥–∞**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –∫–æ–¥ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
6. **–ü—Ä–æ–≤–µ—Ä–∫–∞**: –ë—ç–∫–µ–Ω–¥ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ–¥ ‚Üí –µ—Å–ª–∏ –û–ö, —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –∑–∞–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å
7. **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞—Ä–æ–ª—è**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å
8. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –í—Å–µ —Ç–æ–∫–µ–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ—Ç–∑—ã–≤–∞—é—Ç—Å—è

## API Endpoints

### 1. –ó–∞–ø—Ä–æ—Å–∏—Ç—å —Å–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è
```http
POST /auth/password/reset-request
Content-Type: application/json

{
  "email": "user@example.com"
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "message": "–ö–æ–¥ –¥–ª—è —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ email"
}
```

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–¥ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
```http
POST /auth/password/verify-code
Content-Type: application/json

{
  "email": "user@example.com",
  "code": "123456"
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "message": "–ö–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω. –ú–æ–∂–µ—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å"
}
```

### 3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å
```http
POST /auth/password/reset
Content-Type: application/json

{
  "email": "user@example.com",
  "code": "123456",
  "newPassword": "NewSecurePassword123!"
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "message": "–ü–∞—Ä–æ–ª—å —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω–µ–Ω"
}
```

### 4. –û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–µ–∫—à–∏–µ –∫–æ–¥—ã (–∞–¥–º–∏–Ω)
```http
POST /auth/password/cleanup-expired
Authorization: Bearer {jwt_token}
```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Email

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–î–æ–±–∞–≤—å—Ç–µ –≤ `.env.production`:

```env
# Email –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
EMAIL_USER=your_email@gmail.com
EMAIL_PASSWORD=your_app_password
EMAIL_FROM=DockMap <noreply@dockmap.com>
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ App Password –¥–ª—è Gmail

1. –í–∫–ª—é—á–∏—Ç–µ 2FA –≤ Google –∞–∫–∫–∞—É–Ω—Ç–µ
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ [Google App Passwords](https://myaccount.google.com/apppasswords)
3. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π App Password –¥–ª—è "Mail"
4. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π –ø–∞—Ä–æ–ª—å –≤ `EMAIL_PASSWORD`

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ä—ã:
- **TTL –∫–æ–¥–æ–≤**: 10 –º–∏–Ω—É—Ç –∂–∏–∑–Ω–∏ –∫–æ–¥–∞
- **–û–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–µ –∫–æ–¥—ã**: –ö–æ–¥ –Ω–µ–ª—å–∑—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ
- **–û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –∫–æ–¥–æ–≤**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ
- **–û—Ç–∑—ã–≤ —Ç–æ–∫–µ–Ω–æ–≤**: –í—Å–µ JWT —Ç–æ–∫–µ–Ω—ã –æ—Ç–∑—ã–≤–∞—é—Ç—Å—è –ø–æ—Å–ª–µ —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è
- **–°–∫—Ä—ã—Ç–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏**: –ù–µ —Ä–∞—Å–∫—Ä—ã–≤–∞–µ—Ç—Å—è, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ email –≤ —Å–∏—Å—Ç–µ–º–µ
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞**: –†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å `authProvider: EMAIL`

### üîß –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
- **Rate limiting**: –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å –ª–∏–º–∏—Ç –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤
- **CAPTCHA**: –î–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –±–æ—Ç–æ–≤
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –í—Å–µ –ø–æ–ø—ã—Ç–∫–∏ —Å–±—Ä–æ—Å–∞ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è

## –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è VerificationCode entity:

```typescript
{
  id: string;              // UUID
  email?: string;          // Email –¥–ª—è —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è
  phoneNumber?: string;    // –¢–µ–ª–µ—Ñ–æ–Ω –¥–ª—è SMS (—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π)
  code: string;            // 6-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥
  type: 'SMS' | 'EMAIL' | 'PASSWORD_RESET';  // –¢–∏–ø –∫–æ–¥–∞
  isUsed: boolean;         // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –ª–∏ –∫–æ–¥
  expiresAt: Date;         // –í—Ä–µ–º—è –∏—Å—Ç–µ—á–µ–Ω–∏—è
  createdAt: Date;         // –í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è
}
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. Swagger UI
–î–æ—Å—Ç—É–ø–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É: `GET /api`
- –†–∞–∑–¥–µ–ª: **Password Reset**
- –í—Å–µ 4 endpoint'–∞ —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏

### 2. Postman/Curl –ø—Ä–∏–º–µ—Ä—ã:

```bash
# 1. –ó–∞–ø—Ä–æ—Å–∏—Ç—å –∫–æ–¥
curl -X POST http://localhost:3000/auth/password/reset-request \
  -H "Content-Type: application/json" \
  -d '{"email": "test@example.com"}'

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–¥ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
curl -X POST http://localhost:3000/auth/password/verify-code \
  -H "Content-Type: application/json" \
  -d '{"email": "test@example.com", "code": "123456"}'

# 3. –°–±—Ä–æ—Å–∏—Ç—å –ø–∞—Ä–æ–ª—å
curl -X POST http://localhost:3000/auth/password/reset \
  -H "Content-Type: application/json" \
  -d '{"email": "test@example.com", "code": "123456", "newPassword": "NewPassword123!"}'
```

## –û—à–∏–±–∫–∏ –∏ –∏—Ö —Ä–µ—à–µ–Ω–∏–µ

### –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ email:
```json
{
  "success": false,
  "message": "–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ email. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ"
}
```
**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ EMAIL_USER –∏ EMAIL_PASSWORD

### –ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥:
```json
{
  "success": false,
  "message": "–ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥ –∏–ª–∏ –∫–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω"
}
```
**–†–µ—à–µ–Ω–∏–µ**: –ö–æ–¥ –Ω–µ–≤–µ—Ä–Ω—ã–π, –∏—Å—Ç–µ–∫ –∏–ª–∏ —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω

### Email –Ω–µ –Ω–∞–π–¥–µ–Ω:
```json
{
  "success": true,
  "message": "–ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω–Ω—ã–π email —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ —Å–∏—Å—Ç–µ–º–µ, –∫–æ–¥ –±—ã–ª –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω"
}
```
**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –ò–∑ —Å–æ–æ–±—Ä–∞–∂–µ–Ω–∏–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –≤—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —É—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º

### –ü—Ä–∏–º–µ—Ä React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞:

```typescript
const resetPassword = async (email: string, code: string, newPassword: string) => {
  try {
    const response = await fetch('/auth/password/reset', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email, code, newPassword })
    });
    
    const result = await response.json();
    
    if (result.success) {
      // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞
      router.push('/login');
      toast.success('–ü–∞—Ä–æ–ª—å —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω–µ–Ω');
    } else {
      toast.error(result.message);
    }
  } catch (error) {
    toast.error('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞');
  }
};
```

---

‚úÖ **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!**
