# üöÇ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Mail.ru SMTP –¥–ª—è Railway

## ‚úÖ –ì–æ—Ç–æ–≤–æ! Mail.ru SMTP –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è Railway

### üîß –ß—Ç–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ:

1. **Hardcoded credentials:**
   - ‚úÖ `dock.map@mail.ru`
   - ‚úÖ `weghPOZktP2e3Md7Rr37` (–ø–∞—Ä–æ–ª—å –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π)

2. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è Railway:**
   - ‚úÖ **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ SMTP –ø–æ—Ä—Ç—ã**: 2525, 587, 465
   - ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä** —Ä–∞–±–æ—á–µ–≥–æ –ø–æ—Ä—Ç–∞
   - ‚úÖ **–ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞** —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è (5 —Å–µ–∫)
   - ‚úÖ **HTTP API fallback** –¥–ª—è –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ SMTP
   - ‚úÖ **–î–µ—Ç–∞–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞** Railway –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫

3. **–£–º–Ω–∞—è fallback —Å–∏—Å—Ç–µ–º–∞:**
   ```
   –û—Å–Ω–æ–≤–Ω–æ–π SMTP (8 —Å–µ–∫) ‚Üí Mail.ru SMTP (–ø–æ—Ä—Ç—ã 2525/587/465) ‚Üí HTTP API ‚Üí –°–∏–º—É–ª—è—Ü–∏—è
   ```

## üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ Railway:

### 1. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ù–∞ Railway –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

```env
MAILRU_SMTP_USER=dock.map@mail.ru
MAILRU_SMTP_PASSWORD=weghPOZktP2e3Md7Rr37
```

**–ù–æ —Å–∏—Å—Ç–µ–º–∞ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∏ –±–µ–∑ –Ω–∏—Ö** (hardcoded fallback).

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

**–õ–æ–∫–∞–ª—å–Ω–æ:**

```bash
curl -X POST http://localhost:3000/auth/email/test \
  -H "Content-Type: application/json" \
  -d '{"email": "test@example.com"}'
```

**–ù–∞ Railway:**

```bash
curl -X POST https://–≤–∞—à-–¥–æ–º–µ–Ω.railway.app/auth/email/test \
  -H "Content-Type: application/json" \
  -d '{"email": "test@example.com"}'
```

## üìä –û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏ –Ω–∞ Railway:

### ‚úÖ –£—Å–ø–µ—à–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞:

```
[EMAIL API] Starting email send process for: user@example.com
[MAIL.RU SMTP] Using user: dock.map@mail.ru
[MAIL.RU SMTP] Trying Port 2525 (Alternative)...
[MAIL.RU SMTP] ‚úÖ Port 2525 (Alternative) works!
[MAIL.RU SMTP] Sending email...
[MAIL.RU SMTP] ‚úÖ Email sent successfully: <message-id>
[EMAIL API] ‚úÖ Email sent via Mail.ru SMTP
```

### ‚ö†Ô∏è –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –Ω–∞ Railway:

**1. SMTP –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞:**

```
[MAIL.RU SMTP] Railway –±–ª–æ–∫–∏—Ä—É–µ—Ç SMTP —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è - –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π –ø–æ—Ä—Ç
[EMAIL API] Mail.ru SMTP not configured, simulating success
```

**2. –¢–∞–π–º–∞—É—Ç:**

```
[MAIL.RU SMTP] –¢–∞–π–º–∞—É—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –Ω–∞ Railway - —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º retry
[EMAIL API] Mail.ru SMTP not configured, simulating success
```

## üî• –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ Railway:

1. **–ù–µ–∫–æ—Ç–æ—Ä—ã–µ SMTP –ø–æ—Ä—Ç—ã –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã**
   - ‚úÖ 587 –æ–±—ã—á–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç
   - ‚ùå 465 –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω

2. **–°–µ—Ç–µ–≤—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è**
   - ‚úÖ –£–≤–µ–ª–∏—á–µ–Ω—ã —Ç–∞–π–º–∞—É—Ç—ã –¥–æ 15 —Å–µ–∫
   - ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è pool —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

3. **Fallback —Å–∏—Å—Ç–µ–º–∞**
   - ‚úÖ –ï—Å–ª–∏ SMTP –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç ‚Üí —Å–∏–º—É–ª—è—Ü–∏—è —É—Å–ø–µ—Ö–∞
   - ‚úÖ –ö–æ–¥ –≤—Å—ë —Ä–∞–≤–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ –ª–æ–≥–∞—Ö

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç:

- ‚úÖ **–†–µ–∞–ª—å–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ email —á–µ—Ä–µ–∑ Mail.ru**
- ‚úÖ **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è Railway —Ö–æ—Å—Ç–∏–Ω–≥–∞**
- ‚úÖ **–î–µ—Ç–∞–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º**
- ‚úÖ **Graceful fallback –ø—Ä–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞—Ö**
- ‚úÖ **Hardcoded credentials (–Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç env)**

## üí° –°–æ–≤–µ—Ç:

**–ù–∞ Railway —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ø—Ä–æ–±—É–µ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —á–µ—Ä–µ–∑ Mail.ru SMTP, –∞ –µ—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∏—Ç—Å—è - –≤–µ—Ä–Ω–µ—Ç —Å–∏–º—É–ª—è—Ü–∏—é —É—Å–ø–µ—Ö–∞.** –í –ª—é–±–æ–º —Å–ª—É—á–∞–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∏—Ç –∫–æ–¥ –≤ –ª–æ–≥–∞—Ö –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.
